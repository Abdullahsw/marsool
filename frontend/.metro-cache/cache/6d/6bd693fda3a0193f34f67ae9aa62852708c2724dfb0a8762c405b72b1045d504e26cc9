{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"firebase/firestore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":82,"index":116}}],"key":"n8ZdwTgQb9oFW01pH/SKxYwC/nA=","exportNames":["*"],"imports":1}},{"name":"../config/firebase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":117},"end":{"line":3,"column":40,"index":157}}],"key":"K/SZPG5sPeV1upVh8dao26aG7MQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"useCoupons\", {\n    enumerable: true,\n    get: function () {\n      return useCoupons;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[1], \"@babel/runtime/helpers/slicedToArray\");\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  var _react = require(_dependencyMap[2], \"react\");\n  var _firebaseFirestore = require(_dependencyMap[3], \"firebase/firestore\");\n  var _configFirebase = require(_dependencyMap[4], \"../config/firebase\");\n  var useCoupons = () => {\n    _s();\n    var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray.default)(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n    var _useState3 = (0, _react.useState)(null),\n      _useState4 = (0, _slicedToArray.default)(_useState3, 2),\n      error = _useState4[0],\n      setError = _useState4[1];\n    var validateCoupon = /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (code, orderTotal) {\n        try {\n          setLoading(true);\n          setError(null);\n\n          // Fetch coupon from Firebase\n          var couponsRef = (0, _firebaseFirestore.collection)(_configFirebase.db, 'coupons');\n          var q = (0, _firebaseFirestore.query)(couponsRef, (0, _firebaseFirestore.where)('code', '==', code.trim().toUpperCase()));\n          var querySnapshot = yield (0, _firebaseFirestore.getDocs)(q);\n          if (querySnapshot.empty) {\n            return {\n              valid: false,\n              message: 'الكود غير صحيح'\n            };\n          }\n          var couponDoc = querySnapshot.docs[0];\n          var coupon = couponDoc.data();\n\n          // Check if active\n          if (!coupon.isActive) {\n            return {\n              valid: false,\n              message: 'هذا الكود غير نشط'\n            };\n          }\n\n          // Check dates\n          var now = new Date();\n          var startDate = coupon.startDate.toDate();\n          var endDate = coupon.endDate.toDate();\n          if (now < startDate) {\n            return {\n              valid: false,\n              message: 'هذا الكود لم يبدأ بعد'\n            };\n          }\n          if (now > endDate) {\n            return {\n              valid: false,\n              message: 'هذا الكود منتهي الصلاحية'\n            };\n          }\n\n          // Check minimum order value\n          if (orderTotal < coupon.minOrderValue) {\n            return {\n              valid: false,\n              message: `الحد الأدنى للطلب ${coupon.minOrderValue.toLocaleString('ar-IQ')} د.ع`\n            };\n          }\n\n          // Check usage limit\n          if (coupon.usageLimit?.total && coupon.stats?.totalUses) {\n            if (coupon.stats.totalUses >= coupon.usageLimit.total) {\n              return {\n                valid: false,\n                message: 'تم استخدام هذا الكود بالكامل'\n              };\n            }\n          }\n\n          // Calculate discount\n          var discount = 0;\n          if (coupon.discountType === 'percentage') {\n            discount = orderTotal * coupon.value / 100;\n            if (coupon.maxDiscountAmount && discount > coupon.maxDiscountAmount) {\n              discount = coupon.maxDiscountAmount;\n            }\n          } else {\n            discount = coupon.value;\n          }\n          return {\n            valid: true,\n            coupon,\n            discount: Math.round(discount),\n            message: `تم تطبيق خصم ${Math.round(discount).toLocaleString('ar-IQ')} د.ع`\n          };\n        } catch (err) {\n          console.error('Error validating coupon:', err);\n          setError(err.message);\n          return {\n            valid: false,\n            message: 'حدث خطأ أثناء التحقق من الكود'\n          };\n        } finally {\n          setLoading(false);\n        }\n      });\n      return function validateCoupon(_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    return {\n      validateCoupon,\n      loading,\n      error\n    };\n  };\n  _s(useCoupons, \"Iz3ozxQ+abMaAIcGIvU8cKUcBeo=\");\n});","lineCount":136,"map":[[13,2,24,0,"Object"],[13,8,24,0],[13,9,24,0,"defineProperty"],[13,23,24,0],[13,24,24,0,"exports"],[13,31,24,0],[14,4,24,0,"enumerable"],[14,14,24,0],[15,4,24,0,"get"],[15,7,24,0],[15,18,24,0,"get"],[15,19,24,0],[16,6,24,0],[16,13,24,0,"useCoupons"],[16,23,24,0],[17,4,24,0],[18,2,24,0],[19,2,128,2],[19,6,128,2,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,128,2],[19,45,128,2,"require"],[19,52,128,2],[19,53,128,2,"_dependencyMap"],[19,67,128,2],[20,2,128,2],[20,6,128,2,"_asyncToGenerator"],[20,23,128,2],[20,26,128,2,"_interopDefault"],[20,41,128,2],[20,42,128,2,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,128,2],[21,2,128,2],[21,6,128,2,"_babelRuntimeHelpersSlicedToArray"],[21,39,128,2],[21,42,128,2,"require"],[21,49,128,2],[21,50,128,2,"_dependencyMap"],[21,64,128,2],[22,2,128,2],[22,6,128,2,"_slicedToArray"],[22,20,128,2],[22,23,128,2,"_interopDefault"],[22,38,128,2],[22,39,128,2,"_babelRuntimeHelpersSlicedToArray"],[22,72,128,2],[23,2,1,0],[23,6,1,0,"_react"],[23,12,1,0],[23,15,1,0,"require"],[23,22,1,0],[23,23,1,0,"_dependencyMap"],[23,37,1,0],[24,2,2,0],[24,6,2,0,"_firebaseFirestore"],[24,24,2,0],[24,27,2,0,"require"],[24,34,2,0],[24,35,2,0,"_dependencyMap"],[24,49,2,0],[25,2,3,0],[25,6,3,0,"_configFirebase"],[25,21,3,0],[25,24,3,0,"require"],[25,31,3,0],[25,32,3,0,"_dependencyMap"],[25,46,3,0],[26,2,24,7],[26,6,24,13,"useCoupons"],[26,16,24,23],[26,19,24,26,"useCoupons"],[26,20,24,26],[26,25,24,32],[27,4,24,32,"_s"],[27,6,24,32],[28,4,25,2],[28,8,25,2,"_useState"],[28,17,25,2],[28,20,25,32],[28,24,25,32,"useState"],[28,30,25,40],[28,31,25,40,"useState"],[28,39,25,40],[28,41,25,41],[28,46,25,46],[28,47,25,47],[29,6,25,47,"_useState2"],[29,16,25,47],[29,23,25,47,"_slicedToArray"],[29,37,25,47],[29,38,25,47,"default"],[29,45,25,47],[29,47,25,47,"_useState"],[29,56,25,47],[30,6,25,9,"loading"],[30,13,25,16],[30,16,25,16,"_useState2"],[30,26,25,16],[31,6,25,18,"setLoading"],[31,16,25,28],[31,19,25,28,"_useState2"],[31,29,25,28],[32,4,26,2],[32,8,26,2,"_useState3"],[32,18,26,2],[32,21,26,28],[32,25,26,28,"useState"],[32,31,26,36],[32,32,26,36,"useState"],[32,40,26,36],[32,42,26,52],[32,46,26,56],[32,47,26,57],[33,6,26,57,"_useState4"],[33,16,26,57],[33,23,26,57,"_slicedToArray"],[33,37,26,57],[33,38,26,57,"default"],[33,45,26,57],[33,47,26,57,"_useState3"],[33,57,26,57],[34,6,26,9,"error"],[34,11,26,14],[34,14,26,14,"_useState4"],[34,24,26,14],[35,6,26,16,"setError"],[35,14,26,24],[35,17,26,24,"_useState4"],[35,27,26,24],[36,4,28,2],[36,8,28,8,"validateCoupon"],[36,22,28,22],[37,6,28,22],[37,10,28,22,"_ref"],[37,14,28,22],[37,21,28,22,"_asyncToGenerator"],[37,38,28,22],[37,39,28,22,"default"],[37,46,28,22],[37,48,28,25],[37,59,28,32,"code"],[37,63,28,44],[37,65,28,46,"orderTotal"],[37,75,28,64],[37,77,33,8],[38,8,34,4],[38,12,34,8],[39,10,35,6,"setLoading"],[39,20,35,16],[39,21,35,17],[39,25,35,21],[39,26,35,22],[40,10,36,6,"setError"],[40,18,36,14],[40,19,36,15],[40,23,36,19],[40,24,36,20],[42,10,38,6],[43,10,39,6],[43,14,39,12,"couponsRef"],[43,24,39,22],[43,27,39,25],[43,31,39,25,"collection"],[43,49,39,35],[43,50,39,35,"collection"],[43,60,39,35],[43,62,39,36,"db"],[43,77,39,38],[43,78,39,38,"db"],[43,80,39,38],[43,82,39,40],[43,91,39,49],[43,92,39,50],[44,10,40,6],[44,14,40,12,"q"],[44,15,40,13],[44,18,40,16],[44,22,40,16,"query"],[44,40,40,21],[44,41,40,21,"query"],[44,46,40,21],[44,48,40,22,"couponsRef"],[44,58,40,32],[44,60,40,34],[44,64,40,34,"where"],[44,82,40,39],[44,83,40,39,"where"],[44,88,40,39],[44,90,40,40],[44,96,40,46],[44,98,40,48],[44,102,40,52],[44,104,40,54,"code"],[44,108,40,58],[44,109,40,59,"trim"],[44,113,40,63],[44,114,40,64],[44,115,40,65],[44,116,40,66,"toUpperCase"],[44,127,40,77],[44,128,40,78],[44,129,40,79],[44,130,40,80],[44,131,40,81],[45,10,41,6],[45,14,41,12,"querySnapshot"],[45,27,41,25],[45,36,41,34],[45,40,41,34,"getDocs"],[45,58,41,41],[45,59,41,41,"getDocs"],[45,66,41,41],[45,68,41,42,"q"],[45,69,41,43],[45,70,41,44],[46,10,43,6],[46,14,43,10,"querySnapshot"],[46,27,43,23],[46,28,43,24,"empty"],[46,33,43,29],[46,35,43,31],[47,12,44,8],[47,19,44,15],[48,14,45,10,"valid"],[48,19,45,15],[48,21,45,17],[48,26,45,22],[49,14,46,10,"message"],[49,21,46,17],[49,23,46,19],[50,12,47,8],[50,13,47,9],[51,10,48,6],[52,10,50,6],[52,14,50,12,"couponDoc"],[52,23,50,21],[52,26,50,24,"querySnapshot"],[52,39,50,37],[52,40,50,38,"docs"],[52,44,50,42],[52,45,50,43],[52,46,50,44],[52,47,50,45],[53,10,51,6],[53,14,51,12,"coupon"],[53,20,51,18],[53,23,51,21,"couponDoc"],[53,32,51,30],[53,33,51,31,"data"],[53,37,51,35],[53,38,51,36],[53,39,51,47],[55,10,53,6],[56,10,54,6],[56,14,54,10],[56,15,54,11,"coupon"],[56,21,54,17],[56,22,54,18,"isActive"],[56,30,54,26],[56,32,54,28],[57,12,55,8],[57,19,55,15],[58,14,56,10,"valid"],[58,19,56,15],[58,21,56,17],[58,26,56,22],[59,14,57,10,"message"],[59,21,57,17],[59,23,57,19],[60,12,58,8],[60,13,58,9],[61,10,59,6],[63,10,61,6],[64,10,62,6],[64,14,62,12,"now"],[64,17,62,15],[64,20,62,18],[64,24,62,22,"Date"],[64,28,62,26],[64,29,62,27],[64,30,62,28],[65,10,63,6],[65,14,63,12,"startDate"],[65,23,63,21],[65,26,63,24,"coupon"],[65,32,63,30],[65,33,63,31,"startDate"],[65,42,63,40],[65,43,63,41,"toDate"],[65,49,63,47],[65,50,63,48],[65,51,63,49],[66,10,64,6],[66,14,64,12,"endDate"],[66,21,64,19],[66,24,64,22,"coupon"],[66,30,64,28],[66,31,64,29,"endDate"],[66,38,64,36],[66,39,64,37,"toDate"],[66,45,64,43],[66,46,64,44],[66,47,64,45],[67,10,66,6],[67,14,66,10,"now"],[67,17,66,13],[67,20,66,16,"startDate"],[67,29,66,25],[67,31,66,27],[68,12,67,8],[68,19,67,15],[69,14,68,10,"valid"],[69,19,68,15],[69,21,68,17],[69,26,68,22],[70,14,69,10,"message"],[70,21,69,17],[70,23,69,19],[71,12,70,8],[71,13,70,9],[72,10,71,6],[73,10,73,6],[73,14,73,10,"now"],[73,17,73,13],[73,20,73,16,"endDate"],[73,27,73,23],[73,29,73,25],[74,12,74,8],[74,19,74,15],[75,14,75,10,"valid"],[75,19,75,15],[75,21,75,17],[75,26,75,22],[76,14,76,10,"message"],[76,21,76,17],[76,23,76,19],[77,12,77,8],[77,13,77,9],[78,10,78,6],[80,10,80,6],[81,10,81,6],[81,14,81,10,"orderTotal"],[81,24,81,20],[81,27,81,23,"coupon"],[81,33,81,29],[81,34,81,30,"minOrderValue"],[81,47,81,43],[81,49,81,45],[82,12,82,8],[82,19,82,15],[83,14,83,10,"valid"],[83,19,83,15],[83,21,83,17],[83,26,83,22],[84,14,84,10,"message"],[84,21,84,17],[84,23,84,19],[84,44,84,40,"coupon"],[84,50,84,46],[84,51,84,47,"minOrderValue"],[84,64,84,60],[84,65,84,61,"toLocaleString"],[84,79,84,75],[84,80,84,76],[84,87,84,83],[84,88,84,84],[85,12,85,8],[85,13,85,9],[86,10,86,6],[88,10,88,6],[89,10,89,6],[89,14,89,10,"coupon"],[89,20,89,16],[89,21,89,17,"usageLimit"],[89,31,89,27],[89,33,89,29,"total"],[89,38,89,34],[89,42,89,38,"coupon"],[89,48,89,44],[89,49,89,45,"stats"],[89,54,89,50],[89,56,89,52,"totalUses"],[89,65,89,61],[89,67,89,63],[90,12,90,8],[90,16,90,12,"coupon"],[90,22,90,18],[90,23,90,19,"stats"],[90,28,90,24],[90,29,90,25,"totalUses"],[90,38,90,34],[90,42,90,38,"coupon"],[90,48,90,44],[90,49,90,45,"usageLimit"],[90,59,90,55],[90,60,90,56,"total"],[90,65,90,61],[90,67,90,63],[91,14,91,10],[91,21,91,17],[92,16,92,12,"valid"],[92,21,92,17],[92,23,92,19],[92,28,92,24],[93,16,93,12,"message"],[93,23,93,19],[93,25,93,21],[94,14,94,10],[94,15,94,11],[95,12,95,8],[96,10,96,6],[98,10,98,6],[99,10,99,6],[99,14,99,10,"discount"],[99,22,99,18],[99,25,99,21],[99,26,99,22],[100,10,100,6],[100,14,100,10,"coupon"],[100,20,100,16],[100,21,100,17,"discountType"],[100,33,100,29],[100,38,100,34],[100,50,100,46],[100,52,100,48],[101,12,101,8,"discount"],[101,20,101,16],[101,23,101,20,"orderTotal"],[101,33,101,30],[101,36,101,33,"coupon"],[101,42,101,39],[101,43,101,40,"value"],[101,48,101,45],[101,51,101,49],[101,54,101,52],[102,12,102,8],[102,16,102,12,"coupon"],[102,22,102,18],[102,23,102,19,"maxDiscountAmount"],[102,40,102,36],[102,44,102,40,"discount"],[102,52,102,48],[102,55,102,51,"coupon"],[102,61,102,57],[102,62,102,58,"maxDiscountAmount"],[102,79,102,75],[102,81,102,77],[103,14,103,10,"discount"],[103,22,103,18],[103,25,103,21,"coupon"],[103,31,103,27],[103,32,103,28,"maxDiscountAmount"],[103,49,103,45],[104,12,104,8],[105,10,105,6],[105,11,105,7],[105,17,105,13],[106,12,106,8,"discount"],[106,20,106,16],[106,23,106,19,"coupon"],[106,29,106,25],[106,30,106,26,"value"],[106,35,106,31],[107,10,107,6],[108,10,109,6],[108,17,109,13],[109,12,110,8,"valid"],[109,17,110,13],[109,19,110,15],[109,23,110,19],[110,12,111,8,"coupon"],[110,18,111,14],[111,12,112,8,"discount"],[111,20,112,16],[111,22,112,18,"Math"],[111,26,112,22],[111,27,112,23,"round"],[111,32,112,28],[111,33,112,29,"discount"],[111,41,112,37],[111,42,112,38],[112,12,113,8,"message"],[112,19,113,15],[112,21,113,17],[112,37,113,33,"Math"],[112,41,113,37],[112,42,113,38,"round"],[112,47,113,43],[112,48,113,44,"discount"],[112,56,113,52],[112,57,113,53],[112,58,113,54,"toLocaleString"],[112,72,113,68],[112,73,113,69],[112,80,113,76],[112,81,113,77],[113,10,114,6],[113,11,114,7],[114,8,115,4],[114,9,115,5],[114,10,115,6],[114,17,115,13,"err"],[114,20,115,21],[114,22,115,23],[115,10,116,6,"console"],[115,17,116,13],[115,18,116,14,"error"],[115,23,116,19],[115,24,116,20],[115,50,116,46],[115,52,116,48,"err"],[115,55,116,51],[115,56,116,52],[116,10,117,6,"setError"],[116,18,117,14],[116,19,117,15,"err"],[116,22,117,18],[116,23,117,19,"message"],[116,30,117,26],[116,31,117,27],[117,10,118,6],[117,17,118,13],[118,12,119,8,"valid"],[118,17,119,13],[118,19,119,15],[118,24,119,20],[119,12,120,8,"message"],[119,19,120,15],[119,21,120,17],[120,10,121,6],[120,11,121,7],[121,8,122,4],[121,9,122,5],[121,18,122,14],[122,10,123,6,"setLoading"],[122,20,123,16],[122,21,123,17],[122,26,123,22],[122,27,123,23],[123,8,124,4],[124,6,125,2],[124,7,125,3],[125,6,125,3],[125,22,28,8,"validateCoupon"],[125,36,28,22,"validateCoupon"],[125,37,28,22,"_x"],[125,39,28,22],[125,41,28,22,"_x2"],[125,44,28,22],[126,8,28,22],[126,15,28,22,"_ref"],[126,19,28,22],[126,20,28,22,"apply"],[126,25,28,22],[126,32,28,22,"arguments"],[126,41,28,22],[127,6,28,22],[128,4,28,22],[128,7,125,3],[129,4,127,2],[129,11,127,9],[130,6,127,11,"validateCoupon"],[130,20,127,25],[131,6,127,27,"loading"],[131,13,127,34],[132,6,127,36,"error"],[133,4,127,42],[133,5,127,43],[134,2,128,0],[134,3,128,1],[135,2,128,2,"_s"],[135,4,128,2],[135,5,24,13,"useCoupons"],[135,15,24,23],[136,0,24,23],[136,3]],"functionMap":{"names":["<global>","useCoupons","validateCoupon"],"mappings":"AAA;0BCuB;yBCI;GDiG;CDG"},"hasCjsExports":false},"type":"js/module"}]}