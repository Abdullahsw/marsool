{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"firebase/firestore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":82,"index":116}}],"key":"n8ZdwTgQb9oFW01pH/SKxYwC/nA=","exportNames":["*"],"imports":1}},{"name":"../config/firebase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":117},"end":{"line":3,"column":40,"index":157}}],"key":"K/SZPG5sPeV1upVh8dao26aG7MQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"useCoupons\", {\n    enumerable: true,\n    get: function () {\n      return useCoupons;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _firebaseFirestore = require(_dependencyMap[1], \"firebase/firestore\");\n  var _configFirebase = require(_dependencyMap[2], \"../config/firebase\");\n  const useCoupons = () => {\n    const [loading, setLoading] = (0, _react.useState)(false);\n    const [error, setError] = (0, _react.useState)(null);\n    const validateCoupon = async (code, orderTotal) => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        // Fetch coupon from Firebase\n        const couponsRef = (0, _firebaseFirestore.collection)(_configFirebase.db, 'coupons');\n        const q = (0, _firebaseFirestore.query)(couponsRef, (0, _firebaseFirestore.where)('code', '==', code.trim().toUpperCase()));\n        const querySnapshot = await (0, _firebaseFirestore.getDocs)(q);\n        if (querySnapshot.empty) {\n          return {\n            valid: false,\n            message: 'الكود غير صحيح'\n          };\n        }\n        const couponDoc = querySnapshot.docs[0];\n        const coupon = couponDoc.data();\n\n        // Check if active\n        if (!coupon.isActive) {\n          return {\n            valid: false,\n            message: 'هذا الكود غير نشط'\n          };\n        }\n\n        // Check dates\n        const now = new Date();\n        const startDate = coupon.startDate.toDate();\n        const endDate = coupon.endDate.toDate();\n        if (now < startDate) {\n          return {\n            valid: false,\n            message: 'هذا الكود لم يبدأ بعد'\n          };\n        }\n        if (now > endDate) {\n          return {\n            valid: false,\n            message: 'هذا الكود منتهي الصلاحية'\n          };\n        }\n\n        // Check minimum order value\n        if (orderTotal < coupon.minOrderValue) {\n          return {\n            valid: false,\n            message: `الحد الأدنى للطلب ${coupon.minOrderValue.toLocaleString('ar-IQ')} د.ع`\n          };\n        }\n\n        // Check usage limit\n        if (coupon.usageLimit?.total && coupon.stats?.totalUses) {\n          if (coupon.stats.totalUses >= coupon.usageLimit.total) {\n            return {\n              valid: false,\n              message: 'تم استخدام هذا الكود بالكامل'\n            };\n          }\n        }\n\n        // Calculate discount\n        let discount = 0;\n        if (coupon.discountType === 'percentage') {\n          discount = orderTotal * coupon.value / 100;\n          if (coupon.maxDiscountAmount && discount > coupon.maxDiscountAmount) {\n            discount = coupon.maxDiscountAmount;\n          }\n        } else {\n          discount = coupon.value;\n        }\n        return {\n          valid: true,\n          coupon,\n          discount: Math.round(discount),\n          message: `تم تطبيق خصم ${Math.round(discount).toLocaleString('ar-IQ')} د.ع`\n        };\n      } catch (err) {\n        console.error('Error validating coupon:', err);\n        setError(err.message);\n        return {\n          valid: false,\n          message: 'حدث خطأ أثناء التحقق من الكود'\n        };\n      } finally {\n        setLoading(false);\n      }\n    };\n    return {\n      validateCoupon,\n      loading,\n      error\n    };\n  };\n});","lineCount":113,"map":[[7,2,24,0,"Object"],[7,8,24,0],[7,9,24,0,"defineProperty"],[7,23,24,0],[7,24,24,0,"exports"],[7,31,24,0],[8,4,24,0,"enumerable"],[8,14,24,0],[9,4,24,0,"get"],[9,7,24,0],[9,18,24,0,"get"],[9,19,24,0],[10,6,24,0],[10,13,24,0,"useCoupons"],[10,23,24,0],[11,4,24,0],[12,2,24,0],[13,2,1,0],[13,6,1,0,"_react"],[13,12,1,0],[13,15,1,0,"require"],[13,22,1,0],[13,23,1,0,"_dependencyMap"],[13,37,1,0],[14,2,2,0],[14,6,2,0,"_firebaseFirestore"],[14,24,2,0],[14,27,2,0,"require"],[14,34,2,0],[14,35,2,0,"_dependencyMap"],[14,49,2,0],[15,2,3,0],[15,6,3,0,"_configFirebase"],[15,21,3,0],[15,24,3,0,"require"],[15,31,3,0],[15,32,3,0,"_dependencyMap"],[15,46,3,0],[16,2,24,7],[16,8,24,13,"useCoupons"],[16,18,24,23],[16,21,24,26,"useCoupons"],[16,22,24,26],[16,27,24,32],[17,4,25,2],[17,10,25,8],[17,11,25,9,"loading"],[17,18,25,16],[17,20,25,18,"setLoading"],[17,30,25,28],[17,31,25,29],[17,34,25,32],[17,38,25,32,"useState"],[17,44,25,40],[17,45,25,40,"useState"],[17,53,25,40],[17,55,25,41],[17,60,25,46],[17,61,25,47],[18,4,26,2],[18,10,26,8],[18,11,26,9,"error"],[18,16,26,14],[18,18,26,16,"setError"],[18,26,26,24],[18,27,26,25],[18,30,26,28],[18,34,26,28,"useState"],[18,40,26,36],[18,41,26,36,"useState"],[18,49,26,36],[18,51,26,52],[18,55,26,56],[18,56,26,57],[19,4,28,2],[19,10,28,8,"validateCoupon"],[19,24,28,22],[19,27,28,25],[19,33,28,25,"validateCoupon"],[19,34,28,32,"code"],[19,38,28,44],[19,40,28,46,"orderTotal"],[19,50,28,64],[19,55,33,8],[20,6,34,4],[20,10,34,8],[21,8,35,6,"setLoading"],[21,18,35,16],[21,19,35,17],[21,23,35,21],[21,24,35,22],[22,8,36,6,"setError"],[22,16,36,14],[22,17,36,15],[22,21,36,19],[22,22,36,20],[24,8,38,6],[25,8,39,6],[25,14,39,12,"couponsRef"],[25,24,39,22],[25,27,39,25],[25,31,39,25,"collection"],[25,49,39,35],[25,50,39,35,"collection"],[25,60,39,35],[25,62,39,36,"db"],[25,77,39,38],[25,78,39,38,"db"],[25,80,39,38],[25,82,39,40],[25,91,39,49],[25,92,39,50],[26,8,40,6],[26,14,40,12,"q"],[26,15,40,13],[26,18,40,16],[26,22,40,16,"query"],[26,40,40,21],[26,41,40,21,"query"],[26,46,40,21],[26,48,40,22,"couponsRef"],[26,58,40,32],[26,60,40,34],[26,64,40,34,"where"],[26,82,40,39],[26,83,40,39,"where"],[26,88,40,39],[26,90,40,40],[26,96,40,46],[26,98,40,48],[26,102,40,52],[26,104,40,54,"code"],[26,108,40,58],[26,109,40,59,"trim"],[26,113,40,63],[26,114,40,64],[26,115,40,65],[26,116,40,66,"toUpperCase"],[26,127,40,77],[26,128,40,78],[26,129,40,79],[26,130,40,80],[26,131,40,81],[27,8,41,6],[27,14,41,12,"querySnapshot"],[27,27,41,25],[27,30,41,28],[27,36,41,34],[27,40,41,34,"getDocs"],[27,58,41,41],[27,59,41,41,"getDocs"],[27,66,41,41],[27,68,41,42,"q"],[27,69,41,43],[27,70,41,44],[28,8,43,6],[28,12,43,10,"querySnapshot"],[28,25,43,23],[28,26,43,24,"empty"],[28,31,43,29],[28,33,43,31],[29,10,44,8],[29,17,44,15],[30,12,45,10,"valid"],[30,17,45,15],[30,19,45,17],[30,24,45,22],[31,12,46,10,"message"],[31,19,46,17],[31,21,46,19],[32,10,47,8],[32,11,47,9],[33,8,48,6],[34,8,50,6],[34,14,50,12,"couponDoc"],[34,23,50,21],[34,26,50,24,"querySnapshot"],[34,39,50,37],[34,40,50,38,"docs"],[34,44,50,42],[34,45,50,43],[34,46,50,44],[34,47,50,45],[35,8,51,6],[35,14,51,12,"coupon"],[35,20,51,18],[35,23,51,21,"couponDoc"],[35,32,51,30],[35,33,51,31,"data"],[35,37,51,35],[35,38,51,36],[35,39,51,47],[37,8,53,6],[38,8,54,6],[38,12,54,10],[38,13,54,11,"coupon"],[38,19,54,17],[38,20,54,18,"isActive"],[38,28,54,26],[38,30,54,28],[39,10,55,8],[39,17,55,15],[40,12,56,10,"valid"],[40,17,56,15],[40,19,56,17],[40,24,56,22],[41,12,57,10,"message"],[41,19,57,17],[41,21,57,19],[42,10,58,8],[42,11,58,9],[43,8,59,6],[45,8,61,6],[46,8,62,6],[46,14,62,12,"now"],[46,17,62,15],[46,20,62,18],[46,24,62,22,"Date"],[46,28,62,26],[46,29,62,27],[46,30,62,28],[47,8,63,6],[47,14,63,12,"startDate"],[47,23,63,21],[47,26,63,24,"coupon"],[47,32,63,30],[47,33,63,31,"startDate"],[47,42,63,40],[47,43,63,41,"toDate"],[47,49,63,47],[47,50,63,48],[47,51,63,49],[48,8,64,6],[48,14,64,12,"endDate"],[48,21,64,19],[48,24,64,22,"coupon"],[48,30,64,28],[48,31,64,29,"endDate"],[48,38,64,36],[48,39,64,37,"toDate"],[48,45,64,43],[48,46,64,44],[48,47,64,45],[49,8,66,6],[49,12,66,10,"now"],[49,15,66,13],[49,18,66,16,"startDate"],[49,27,66,25],[49,29,66,27],[50,10,67,8],[50,17,67,15],[51,12,68,10,"valid"],[51,17,68,15],[51,19,68,17],[51,24,68,22],[52,12,69,10,"message"],[52,19,69,17],[52,21,69,19],[53,10,70,8],[53,11,70,9],[54,8,71,6],[55,8,73,6],[55,12,73,10,"now"],[55,15,73,13],[55,18,73,16,"endDate"],[55,25,73,23],[55,27,73,25],[56,10,74,8],[56,17,74,15],[57,12,75,10,"valid"],[57,17,75,15],[57,19,75,17],[57,24,75,22],[58,12,76,10,"message"],[58,19,76,17],[58,21,76,19],[59,10,77,8],[59,11,77,9],[60,8,78,6],[62,8,80,6],[63,8,81,6],[63,12,81,10,"orderTotal"],[63,22,81,20],[63,25,81,23,"coupon"],[63,31,81,29],[63,32,81,30,"minOrderValue"],[63,45,81,43],[63,47,81,45],[64,10,82,8],[64,17,82,15],[65,12,83,10,"valid"],[65,17,83,15],[65,19,83,17],[65,24,83,22],[66,12,84,10,"message"],[66,19,84,17],[66,21,84,19],[66,42,84,40,"coupon"],[66,48,84,46],[66,49,84,47,"minOrderValue"],[66,62,84,60],[66,63,84,61,"toLocaleString"],[66,77,84,75],[66,78,84,76],[66,85,84,83],[66,86,84,84],[67,10,85,8],[67,11,85,9],[68,8,86,6],[70,8,88,6],[71,8,89,6],[71,12,89,10,"coupon"],[71,18,89,16],[71,19,89,17,"usageLimit"],[71,29,89,27],[71,31,89,29,"total"],[71,36,89,34],[71,40,89,38,"coupon"],[71,46,89,44],[71,47,89,45,"stats"],[71,52,89,50],[71,54,89,52,"totalUses"],[71,63,89,61],[71,65,89,63],[72,10,90,8],[72,14,90,12,"coupon"],[72,20,90,18],[72,21,90,19,"stats"],[72,26,90,24],[72,27,90,25,"totalUses"],[72,36,90,34],[72,40,90,38,"coupon"],[72,46,90,44],[72,47,90,45,"usageLimit"],[72,57,90,55],[72,58,90,56,"total"],[72,63,90,61],[72,65,90,63],[73,12,91,10],[73,19,91,17],[74,14,92,12,"valid"],[74,19,92,17],[74,21,92,19],[74,26,92,24],[75,14,93,12,"message"],[75,21,93,19],[75,23,93,21],[76,12,94,10],[76,13,94,11],[77,10,95,8],[78,8,96,6],[80,8,98,6],[81,8,99,6],[81,12,99,10,"discount"],[81,20,99,18],[81,23,99,21],[81,24,99,22],[82,8,100,6],[82,12,100,10,"coupon"],[82,18,100,16],[82,19,100,17,"discountType"],[82,31,100,29],[82,36,100,34],[82,48,100,46],[82,50,100,48],[83,10,101,8,"discount"],[83,18,101,16],[83,21,101,20,"orderTotal"],[83,31,101,30],[83,34,101,33,"coupon"],[83,40,101,39],[83,41,101,40,"value"],[83,46,101,45],[83,49,101,49],[83,52,101,52],[84,10,102,8],[84,14,102,12,"coupon"],[84,20,102,18],[84,21,102,19,"maxDiscountAmount"],[84,38,102,36],[84,42,102,40,"discount"],[84,50,102,48],[84,53,102,51,"coupon"],[84,59,102,57],[84,60,102,58,"maxDiscountAmount"],[84,77,102,75],[84,79,102,77],[85,12,103,10,"discount"],[85,20,103,18],[85,23,103,21,"coupon"],[85,29,103,27],[85,30,103,28,"maxDiscountAmount"],[85,47,103,45],[86,10,104,8],[87,8,105,6],[87,9,105,7],[87,15,105,13],[88,10,106,8,"discount"],[88,18,106,16],[88,21,106,19,"coupon"],[88,27,106,25],[88,28,106,26,"value"],[88,33,106,31],[89,8,107,6],[90,8,109,6],[90,15,109,13],[91,10,110,8,"valid"],[91,15,110,13],[91,17,110,15],[91,21,110,19],[92,10,111,8,"coupon"],[92,16,111,14],[93,10,112,8,"discount"],[93,18,112,16],[93,20,112,18,"Math"],[93,24,112,22],[93,25,112,23,"round"],[93,30,112,28],[93,31,112,29,"discount"],[93,39,112,37],[93,40,112,38],[94,10,113,8,"message"],[94,17,113,15],[94,19,113,17],[94,35,113,33,"Math"],[94,39,113,37],[94,40,113,38,"round"],[94,45,113,43],[94,46,113,44,"discount"],[94,54,113,52],[94,55,113,53],[94,56,113,54,"toLocaleString"],[94,70,113,68],[94,71,113,69],[94,78,113,76],[94,79,113,77],[95,8,114,6],[95,9,114,7],[96,6,115,4],[96,7,115,5],[96,8,115,6],[96,15,115,13,"err"],[96,18,115,21],[96,20,115,23],[97,8,116,6,"console"],[97,15,116,13],[97,16,116,14,"error"],[97,21,116,19],[97,22,116,20],[97,48,116,46],[97,50,116,48,"err"],[97,53,116,51],[97,54,116,52],[98,8,117,6,"setError"],[98,16,117,14],[98,17,117,15,"err"],[98,20,117,18],[98,21,117,19,"message"],[98,28,117,26],[98,29,117,27],[99,8,118,6],[99,15,118,13],[100,10,119,8,"valid"],[100,15,119,13],[100,17,119,15],[100,22,119,20],[101,10,120,8,"message"],[101,17,120,15],[101,19,120,17],[102,8,121,6],[102,9,121,7],[103,6,122,4],[103,7,122,5],[103,16,122,14],[104,8,123,6,"setLoading"],[104,18,123,16],[104,19,123,17],[104,24,123,22],[104,25,123,23],[105,6,124,4],[106,4,125,2],[106,5,125,3],[107,4,127,2],[107,11,127,9],[108,6,127,11,"validateCoupon"],[108,20,127,25],[109,6,127,27,"loading"],[109,13,127,34],[110,6,127,36,"error"],[111,4,127,42],[111,5,127,43],[112,2,128,0],[112,3,128,1],[113,0,128,2],[113,3]],"functionMap":{"names":["<global>","useCoupons","validateCoupon"],"mappings":"AAA;0BCuB;yBCI;GDiG;CDG"},"hasCjsExports":false},"type":"js/module"}]}