{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":33,"index":33}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"firebase/firestore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":34},"end":{"line":2,"column":82,"index":116}}],"key":"n8ZdwTgQb9oFW01pH/SKxYwC/nA=","exportNames":["*"],"imports":1}},{"name":"../config/firebase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":117},"end":{"line":3,"column":40,"index":157}}],"key":"K/SZPG5sPeV1upVh8dao26aG7MQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"useCoupons\", {\n    enumerable: true,\n    get: function () {\n      return useCoupons;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _firebaseFirestore = require(_dependencyMap[1], \"firebase/firestore\");\n  var _configFirebase = require(_dependencyMap[2], \"../config/firebase\");\n  const useCoupons = () => {\n    _s();\n    const [loading, setLoading] = (0, _react.useState)(false);\n    const [error, setError] = (0, _react.useState)(null);\n    const validateCoupon = async (code, orderTotal) => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        // Fetch coupon from Firebase\n        const couponsRef = (0, _firebaseFirestore.collection)(_configFirebase.db, 'coupons');\n        const q = (0, _firebaseFirestore.query)(couponsRef, (0, _firebaseFirestore.where)('code', '==', code.trim().toUpperCase()));\n        const querySnapshot = await (0, _firebaseFirestore.getDocs)(q);\n        if (querySnapshot.empty) {\n          return {\n            valid: false,\n            message: 'الكود غير صحيح'\n          };\n        }\n        const couponDoc = querySnapshot.docs[0];\n        const coupon = couponDoc.data();\n\n        // Check if active\n        if (!coupon.isActive) {\n          return {\n            valid: false,\n            message: 'هذا الكود غير نشط'\n          };\n        }\n\n        // Check dates\n        const now = new Date();\n        const startDate = coupon.startDate.toDate();\n        const endDate = coupon.endDate.toDate();\n        if (now < startDate) {\n          return {\n            valid: false,\n            message: 'هذا الكود لم يبدأ بعد'\n          };\n        }\n        if (now > endDate) {\n          return {\n            valid: false,\n            message: 'هذا الكود منتهي الصلاحية'\n          };\n        }\n\n        // Check minimum order value\n        if (orderTotal < coupon.minOrderValue) {\n          return {\n            valid: false,\n            message: `الحد الأدنى للطلب ${coupon.minOrderValue.toLocaleString('ar-IQ')} د.ع`\n          };\n        }\n\n        // Check usage limit\n        if (coupon.usageLimit?.total && coupon.stats?.totalUses) {\n          if (coupon.stats.totalUses >= coupon.usageLimit.total) {\n            return {\n              valid: false,\n              message: 'تم استخدام هذا الكود بالكامل'\n            };\n          }\n        }\n\n        // Calculate discount\n        let discount = 0;\n        if (coupon.discountType === 'percentage') {\n          discount = orderTotal * coupon.value / 100;\n          if (coupon.maxDiscountAmount && discount > coupon.maxDiscountAmount) {\n            discount = coupon.maxDiscountAmount;\n          }\n        } else {\n          discount = coupon.value;\n        }\n        return {\n          valid: true,\n          coupon,\n          discount: Math.round(discount),\n          message: `تم تطبيق خصم ${Math.round(discount).toLocaleString('ar-IQ')} د.ع`\n        };\n      } catch (err) {\n        console.error('Error validating coupon:', err);\n        setError(err.message);\n        return {\n          valid: false,\n          message: 'حدث خطأ أثناء التحقق من الكود'\n        };\n      } finally {\n        setLoading(false);\n      }\n    };\n    return {\n      validateCoupon,\n      loading,\n      error\n    };\n  };\n  _s(useCoupons, \"Iz3ozxQ+abMaAIcGIvU8cKUcBeo=\");\n});","lineCount":116,"map":[[8,2,24,0,"Object"],[8,8,24,0],[8,9,24,0,"defineProperty"],[8,23,24,0],[8,24,24,0,"exports"],[8,31,24,0],[9,4,24,0,"enumerable"],[9,14,24,0],[10,4,24,0,"get"],[10,7,24,0],[10,18,24,0,"get"],[10,19,24,0],[11,6,24,0],[11,13,24,0,"useCoupons"],[11,23,24,0],[12,4,24,0],[13,2,24,0],[14,2,1,0],[14,6,1,0,"_react"],[14,12,1,0],[14,15,1,0,"require"],[14,22,1,0],[14,23,1,0,"_dependencyMap"],[14,37,1,0],[15,2,2,0],[15,6,2,0,"_firebaseFirestore"],[15,24,2,0],[15,27,2,0,"require"],[15,34,2,0],[15,35,2,0,"_dependencyMap"],[15,49,2,0],[16,2,3,0],[16,6,3,0,"_configFirebase"],[16,21,3,0],[16,24,3,0,"require"],[16,31,3,0],[16,32,3,0,"_dependencyMap"],[16,46,3,0],[17,2,24,7],[17,8,24,13,"useCoupons"],[17,18,24,23],[17,21,24,26,"useCoupons"],[17,22,24,26],[17,27,24,32],[18,4,24,32,"_s"],[18,6,24,32],[19,4,25,2],[19,10,25,8],[19,11,25,9,"loading"],[19,18,25,16],[19,20,25,18,"setLoading"],[19,30,25,28],[19,31,25,29],[19,34,25,32],[19,38,25,32,"useState"],[19,44,25,40],[19,45,25,40,"useState"],[19,53,25,40],[19,55,25,41],[19,60,25,46],[19,61,25,47],[20,4,26,2],[20,10,26,8],[20,11,26,9,"error"],[20,16,26,14],[20,18,26,16,"setError"],[20,26,26,24],[20,27,26,25],[20,30,26,28],[20,34,26,28,"useState"],[20,40,26,36],[20,41,26,36,"useState"],[20,49,26,36],[20,51,26,52],[20,55,26,56],[20,56,26,57],[21,4,28,2],[21,10,28,8,"validateCoupon"],[21,24,28,22],[21,27,28,25],[21,33,28,25,"validateCoupon"],[21,34,28,32,"code"],[21,38,28,44],[21,40,28,46,"orderTotal"],[21,50,28,64],[21,55,33,8],[22,6,34,4],[22,10,34,8],[23,8,35,6,"setLoading"],[23,18,35,16],[23,19,35,17],[23,23,35,21],[23,24,35,22],[24,8,36,6,"setError"],[24,16,36,14],[24,17,36,15],[24,21,36,19],[24,22,36,20],[26,8,38,6],[27,8,39,6],[27,14,39,12,"couponsRef"],[27,24,39,22],[27,27,39,25],[27,31,39,25,"collection"],[27,49,39,35],[27,50,39,35,"collection"],[27,60,39,35],[27,62,39,36,"db"],[27,77,39,38],[27,78,39,38,"db"],[27,80,39,38],[27,82,39,40],[27,91,39,49],[27,92,39,50],[28,8,40,6],[28,14,40,12,"q"],[28,15,40,13],[28,18,40,16],[28,22,40,16,"query"],[28,40,40,21],[28,41,40,21,"query"],[28,46,40,21],[28,48,40,22,"couponsRef"],[28,58,40,32],[28,60,40,34],[28,64,40,34,"where"],[28,82,40,39],[28,83,40,39,"where"],[28,88,40,39],[28,90,40,40],[28,96,40,46],[28,98,40,48],[28,102,40,52],[28,104,40,54,"code"],[28,108,40,58],[28,109,40,59,"trim"],[28,113,40,63],[28,114,40,64],[28,115,40,65],[28,116,40,66,"toUpperCase"],[28,127,40,77],[28,128,40,78],[28,129,40,79],[28,130,40,80],[28,131,40,81],[29,8,41,6],[29,14,41,12,"querySnapshot"],[29,27,41,25],[29,30,41,28],[29,36,41,34],[29,40,41,34,"getDocs"],[29,58,41,41],[29,59,41,41,"getDocs"],[29,66,41,41],[29,68,41,42,"q"],[29,69,41,43],[29,70,41,44],[30,8,43,6],[30,12,43,10,"querySnapshot"],[30,25,43,23],[30,26,43,24,"empty"],[30,31,43,29],[30,33,43,31],[31,10,44,8],[31,17,44,15],[32,12,45,10,"valid"],[32,17,45,15],[32,19,45,17],[32,24,45,22],[33,12,46,10,"message"],[33,19,46,17],[33,21,46,19],[34,10,47,8],[34,11,47,9],[35,8,48,6],[36,8,50,6],[36,14,50,12,"couponDoc"],[36,23,50,21],[36,26,50,24,"querySnapshot"],[36,39,50,37],[36,40,50,38,"docs"],[36,44,50,42],[36,45,50,43],[36,46,50,44],[36,47,50,45],[37,8,51,6],[37,14,51,12,"coupon"],[37,20,51,18],[37,23,51,21,"couponDoc"],[37,32,51,30],[37,33,51,31,"data"],[37,37,51,35],[37,38,51,36],[37,39,51,47],[39,8,53,6],[40,8,54,6],[40,12,54,10],[40,13,54,11,"coupon"],[40,19,54,17],[40,20,54,18,"isActive"],[40,28,54,26],[40,30,54,28],[41,10,55,8],[41,17,55,15],[42,12,56,10,"valid"],[42,17,56,15],[42,19,56,17],[42,24,56,22],[43,12,57,10,"message"],[43,19,57,17],[43,21,57,19],[44,10,58,8],[44,11,58,9],[45,8,59,6],[47,8,61,6],[48,8,62,6],[48,14,62,12,"now"],[48,17,62,15],[48,20,62,18],[48,24,62,22,"Date"],[48,28,62,26],[48,29,62,27],[48,30,62,28],[49,8,63,6],[49,14,63,12,"startDate"],[49,23,63,21],[49,26,63,24,"coupon"],[49,32,63,30],[49,33,63,31,"startDate"],[49,42,63,40],[49,43,63,41,"toDate"],[49,49,63,47],[49,50,63,48],[49,51,63,49],[50,8,64,6],[50,14,64,12,"endDate"],[50,21,64,19],[50,24,64,22,"coupon"],[50,30,64,28],[50,31,64,29,"endDate"],[50,38,64,36],[50,39,64,37,"toDate"],[50,45,64,43],[50,46,64,44],[50,47,64,45],[51,8,66,6],[51,12,66,10,"now"],[51,15,66,13],[51,18,66,16,"startDate"],[51,27,66,25],[51,29,66,27],[52,10,67,8],[52,17,67,15],[53,12,68,10,"valid"],[53,17,68,15],[53,19,68,17],[53,24,68,22],[54,12,69,10,"message"],[54,19,69,17],[54,21,69,19],[55,10,70,8],[55,11,70,9],[56,8,71,6],[57,8,73,6],[57,12,73,10,"now"],[57,15,73,13],[57,18,73,16,"endDate"],[57,25,73,23],[57,27,73,25],[58,10,74,8],[58,17,74,15],[59,12,75,10,"valid"],[59,17,75,15],[59,19,75,17],[59,24,75,22],[60,12,76,10,"message"],[60,19,76,17],[60,21,76,19],[61,10,77,8],[61,11,77,9],[62,8,78,6],[64,8,80,6],[65,8,81,6],[65,12,81,10,"orderTotal"],[65,22,81,20],[65,25,81,23,"coupon"],[65,31,81,29],[65,32,81,30,"minOrderValue"],[65,45,81,43],[65,47,81,45],[66,10,82,8],[66,17,82,15],[67,12,83,10,"valid"],[67,17,83,15],[67,19,83,17],[67,24,83,22],[68,12,84,10,"message"],[68,19,84,17],[68,21,84,19],[68,42,84,40,"coupon"],[68,48,84,46],[68,49,84,47,"minOrderValue"],[68,62,84,60],[68,63,84,61,"toLocaleString"],[68,77,84,75],[68,78,84,76],[68,85,84,83],[68,86,84,84],[69,10,85,8],[69,11,85,9],[70,8,86,6],[72,8,88,6],[73,8,89,6],[73,12,89,10,"coupon"],[73,18,89,16],[73,19,89,17,"usageLimit"],[73,29,89,27],[73,31,89,29,"total"],[73,36,89,34],[73,40,89,38,"coupon"],[73,46,89,44],[73,47,89,45,"stats"],[73,52,89,50],[73,54,89,52,"totalUses"],[73,63,89,61],[73,65,89,63],[74,10,90,8],[74,14,90,12,"coupon"],[74,20,90,18],[74,21,90,19,"stats"],[74,26,90,24],[74,27,90,25,"totalUses"],[74,36,90,34],[74,40,90,38,"coupon"],[74,46,90,44],[74,47,90,45,"usageLimit"],[74,57,90,55],[74,58,90,56,"total"],[74,63,90,61],[74,65,90,63],[75,12,91,10],[75,19,91,17],[76,14,92,12,"valid"],[76,19,92,17],[76,21,92,19],[76,26,92,24],[77,14,93,12,"message"],[77,21,93,19],[77,23,93,21],[78,12,94,10],[78,13,94,11],[79,10,95,8],[80,8,96,6],[82,8,98,6],[83,8,99,6],[83,12,99,10,"discount"],[83,20,99,18],[83,23,99,21],[83,24,99,22],[84,8,100,6],[84,12,100,10,"coupon"],[84,18,100,16],[84,19,100,17,"discountType"],[84,31,100,29],[84,36,100,34],[84,48,100,46],[84,50,100,48],[85,10,101,8,"discount"],[85,18,101,16],[85,21,101,20,"orderTotal"],[85,31,101,30],[85,34,101,33,"coupon"],[85,40,101,39],[85,41,101,40,"value"],[85,46,101,45],[85,49,101,49],[85,52,101,52],[86,10,102,8],[86,14,102,12,"coupon"],[86,20,102,18],[86,21,102,19,"maxDiscountAmount"],[86,38,102,36],[86,42,102,40,"discount"],[86,50,102,48],[86,53,102,51,"coupon"],[86,59,102,57],[86,60,102,58,"maxDiscountAmount"],[86,77,102,75],[86,79,102,77],[87,12,103,10,"discount"],[87,20,103,18],[87,23,103,21,"coupon"],[87,29,103,27],[87,30,103,28,"maxDiscountAmount"],[87,47,103,45],[88,10,104,8],[89,8,105,6],[89,9,105,7],[89,15,105,13],[90,10,106,8,"discount"],[90,18,106,16],[90,21,106,19,"coupon"],[90,27,106,25],[90,28,106,26,"value"],[90,33,106,31],[91,8,107,6],[92,8,109,6],[92,15,109,13],[93,10,110,8,"valid"],[93,15,110,13],[93,17,110,15],[93,21,110,19],[94,10,111,8,"coupon"],[94,16,111,14],[95,10,112,8,"discount"],[95,18,112,16],[95,20,112,18,"Math"],[95,24,112,22],[95,25,112,23,"round"],[95,30,112,28],[95,31,112,29,"discount"],[95,39,112,37],[95,40,112,38],[96,10,113,8,"message"],[96,17,113,15],[96,19,113,17],[96,35,113,33,"Math"],[96,39,113,37],[96,40,113,38,"round"],[96,45,113,43],[96,46,113,44,"discount"],[96,54,113,52],[96,55,113,53],[96,56,113,54,"toLocaleString"],[96,70,113,68],[96,71,113,69],[96,78,113,76],[96,79,113,77],[97,8,114,6],[97,9,114,7],[98,6,115,4],[98,7,115,5],[98,8,115,6],[98,15,115,13,"err"],[98,18,115,21],[98,20,115,23],[99,8,116,6,"console"],[99,15,116,13],[99,16,116,14,"error"],[99,21,116,19],[99,22,116,20],[99,48,116,46],[99,50,116,48,"err"],[99,53,116,51],[99,54,116,52],[100,8,117,6,"setError"],[100,16,117,14],[100,17,117,15,"err"],[100,20,117,18],[100,21,117,19,"message"],[100,28,117,26],[100,29,117,27],[101,8,118,6],[101,15,118,13],[102,10,119,8,"valid"],[102,15,119,13],[102,17,119,15],[102,22,119,20],[103,10,120,8,"message"],[103,17,120,15],[103,19,120,17],[104,8,121,6],[104,9,121,7],[105,6,122,4],[105,7,122,5],[105,16,122,14],[106,8,123,6,"setLoading"],[106,18,123,16],[106,19,123,17],[106,24,123,22],[106,25,123,23],[107,6,124,4],[108,4,125,2],[108,5,125,3],[109,4,127,2],[109,11,127,9],[110,6,127,11,"validateCoupon"],[110,20,127,25],[111,6,127,27,"loading"],[111,13,127,34],[112,6,127,36,"error"],[113,4,127,42],[113,5,127,43],[114,2,128,0],[114,3,128,1],[115,2,128,2,"_s"],[115,4,128,2],[115,5,24,13,"useCoupons"],[115,15,24,23],[116,0,24,23],[116,3]],"functionMap":{"names":["<global>","useCoupons","validateCoupon"],"mappings":"AAA;0BCuB;yBCI;GDiG;CDG"},"hasCjsExports":false},"type":"js/module"}]}